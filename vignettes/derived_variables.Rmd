---
title: "Derived variables"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Derived variables}     
  %\VignetteEngine{knitr::rmarkdown} 
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

_recodeflow_ supports the use of derived variables. This can be any custom function as long as the variable can be calculated on a per row bases. Currently functions requiring operations on the full data set are not supported. Two most common uses for derived variables are: 

- Variable mapping - mapping two or more variables into a single variable.
- Variables that derived using math equations (e.g. BMI is calculated by dividing weight by the square of height). 

`recodeflow` is capable of calculating these more complex derived variables using customs functions that are referenced in `variable_details.csv` within the `RecTo` section with the prefix 'Func::'. The variables used in the function are referenced in the `variableStart` section with the prefix 'DerivedVar::'. For example, the derived variable `example_der` includes `Func::example_der_fun` in the `RecTo` section; and `DerivedVar::[chol, copper]` in the `variableStart` section, which indicates the two starting variables (`chol, copper`).

In order to derive variables, you must load the existing custom function associated with the derived variable.

`example_der_fun` is shown below. The function name must be identical to the function name in variables and variable details, and the order and the number of passed arguments must match. The variable used to create the derived variable must also be present in `variables.csv` and `variable_details.csv`

```{r, warning=FALSE, message=FALSE}
#example_der_fun caluclates chol*copper
#@param chol the row value for chol
#@param copper the row value for copper
#@export 
example_der_fun <- function(chol, copper){
  # as numeric is used to coerce in case categorical numeric variables are used.
  # Warning either chol or copper being NA will ressult in NA return
  example_der <- as.numeric(chol)*as.numeric(copper)
  
  return(example_der)
}
```

**Note:** roxygen2 documentation must be used for a custom function in order for it to be attached to a package. See [here](https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html) on how to document your function using roxygen2 formatting.

To use the custom function they must be loaded in your environment which can be done by simply entering your functions into the console to load them, or attaching them to your own package using the build and install tool and loading that package using "library("name of package")" or by using the `rec_with_table` parameter to pass the path to your function R script.
